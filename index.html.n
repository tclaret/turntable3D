<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Turntable 3D Redesign - Bras de Lecture Corrigé</title>
    <style>
/* ------------------------------------ */
/* 0. VARIABLES CSS GLOBALES            */
/* ------------------------------------ */
:root {
    --color-primary: #c0392b; /* Rouge (Active/Accent) */
    --color-base: #555;        /* Gris foncé (Base platine) */
    --color-control: #333;    /* Noir (Contrôles) */
    --pitch-slider-color: #2c3e50;
    --speed-33-duration: 3.00s; /* Durée d'une rotation à 33 RPM */
}

/* ------------------------------------ */
/* 1. CSS Général & Contrôles           */
/* ------------------------------------ */
body {
    background-color: #f0f0f0;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    margin: 0;
    overflow-x: hidden;
    font-family: Arial, sans-serif;
}

.interface-controls {
    width: 100%; 
    background-color: var(--color-control); 
    color: white; 
    padding: 10px 0;
    display: flex; 
    flex-direction: column; 
    align-items: center;
    position: fixed; 
    top: 0; 
    z-index: 100; 
}
.controls-line {
    display: flex; 
    justify-content: center; 
    align-items: center; 
    gap: 15px; 
    padding: 5px 0;
}
.control-btn {
    cursor: pointer; 
    border: none; 
    padding: 8px 12px; 
    border-radius: 4px;
    font-size: 14px; 
    font-weight: bold; 
    background-color: #777; 
    color: white;
    transition: background-color 0.2s;
}
.control-btn.active { 
    background-color: var(--color-primary); 
}
.control-btn:hover { 
    background-color: #999; 
}
.pitch-group { 
    display: flex; 
    align-items: center; 
    gap: 5px; 
    color: #ccc; 
}
.pitch-group label {
    font-size: 14px;
}
.pitch-slider {
    -webkit-appearance: none; 
    width: 100px; 
    height: 10px; 
    background: #999;
    outline: none; 
    border-radius: 5px; 
    padding: 0;
}
.pitch-slider::-webkit-slider-thumb {
    -webkit-appearance: none; 
    appearance: none;
    width: 20px; 
    height: 20px; 
    background: var(--pitch-slider-color); 
    border-radius: 50%; 
    cursor: pointer;
}

/* ------------------------------------ */
/* 2. Scène 3D & Platine                */
/* ------------------------------------ */
.scene {
    perspective: 500px; 
    width: 80vw; 
    height: 80vh; 
    position: relative;
    margin-top: 100px;
}
.turntable-base {
    width: 90vw; 
    height: 10vw; 
    background-color: var(--color-base); 
    border-radius: 5px;
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
    position: absolute; 
    bottom: 0; 
    left: 50%;
    transform: translateX(-50%) translateY(3vw) rotateX(70deg); 
    transform-origin: bottom center;
    transform-style: preserve-3d;
    z-index: 5;
}

/* ------------------------------------ */
/* 3. SÉLECTEUR DE VITESSE (Chicken Head) */
/* ------------------------------------ */
.speed-selector-container {
    position: absolute; 
    top: 1.5vw; 
    left: 35vw;
    z-index: 10;
    transform: rotateX(-70deg);
    transform-style: preserve-3d; 
    cursor: pointer;
}
.selector-label {
    position: absolute; 
    top: -15px; 
    left: 50%; 
    transform: translateX(-50%);
    font-size: 1.8vw; 
    color: #eee; 
    width: 150%; 
    text-align: center;
}
.selector-base {
    width: 9.6vw; 
    height: 9.6vw;
    background-image: url('https://tclaret.github.io/turntable/img/ChickenHead.png');
    background-size: cover; 
    background-position: center; 
    border-radius: 50%;
    position: relative; 
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.5) inset;
}
.selector-knob {
    width: 4.8vw; 
    height: 4.8vw; 
    background-color: #000; 
    border-radius: 50%;
    position: absolute; 
    top: 50%; 
    left: 50%; 
    transform: translate(-50%, -50%); /* Base 0deg */
    box-shadow: 0 0 5px rgba(0, 0, 0, 0.7); 
    transition: transform 0.3s ease-in-out;
}
.selector-knob::before {
    content: ''; 
    position: absolute; 
    width: 1.8vw; 
    height: 0.6vw;
    background-color: var(--color-primary); 
    top: 0.5vw; 
    left: 50%; 
    transform: translateX(-50%);
    border-radius: 1px;
}

/* ------------------------------------ */
/* 4. BRAS DE LECTURE (POSITIONNEMENT CORRIGÉ) */
/* ------------------------------------ */
.tonearm-container {
    position: absolute;
    /* Positionnement de la base/pivot sur la platine (ajusté en vw) */
    right: 5vw; 
    top: 5vw; 
    z-index: 15;
    
    /* Le conteneur définit la position et l'inclinaison de la base du bras */
    transform: rotateX(-70deg); 
    transform-style: preserve-3d;
    
    /* Taille et style de la base du bras */
    width: 3vw;
    height: 3vw;
    background-color: #222; /* Pour simuler la base du pivot */
    border-radius: 50%;
    
    /* L'origine de la rotation Z sera le centre de cette base */
    transform-origin: center center; 
    
    pointer-events: none;
    transition: transform 0.5s ease-out;
}

.tonearm-image {
    width: 50vw; /* Taille pour contenir toute l'image du bras */
    height: 50vw; 
    position: absolute;
    
    /* Positionner le point de pivot de l'image (son origine de transfo) au centre du conteneur (la base) */
    top: 50%;
    left: 50%;
    
    /* L'origine de l'image (le pivot réel) est fixée à 80% du bord gauche (à ajuster selon votre image) */
    transform-origin: 80% 50%; 
    
    /* Décalage de l'image pour que le pivot soit centré sur la base */
    transform: translate(-80%, -50%); 

    background-image: url('https://tclaret.github.io/turntable/img/BrasDeLecture.png');
    background-size: 100% auto;
    background-repeat: no-repeat;
    background-position: left center;
}

/* ------------------------------------ */
/* 5. Disque Vinyle (inchangé)          */
/* ------------------------------------ */
.record-container {
    width: 75vw; height: 75vw;
    position: absolute; top: 60%; left: 50%;
    transform: translate(-50%, -50%) rotateX(70deg);
    transform-style: preserve-3d; transform-origin: center center;
    background-color: #888; border-radius: 50%;
    z-index: 1; /* Le disque est en dessous du bras */
}

.platter {
    width: 90%; height: 90%; background-color: #444; border-radius: 50%;
    position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
    box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.5);
}

.vinyl-record {
    width: 90%; height: 90%; border-radius: 50%;
    background-image: url('https://tclaret.github.io/turntable/img/DISC.png');
    background-size: cover; background-position: center; background-repeat: no-repeat;
    border: 0.5vw solid #0a0a0a; box-shadow: 0 0 15px rgba(0, 0, 0, 0.7);
    position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
    animation: spin var(--speed-33-duration) linear infinite running; 
    transform-origin: center center;
}

.vinyl-record::after {
    content: ''; position: absolute; top: 50%; left: 50%;
    transform: translate(-50%, -50%); width: 1.5vw; height: 1.5vw;
    border-radius: 50%; background-color: #000; z-index: 2;
}

@keyframes spin {
    from { transform: translate(-50%, -50%) rotateZ(0deg); }
    to { transform: translate(-50%, -50%) rotateZ(360deg); }
}
@keyframes spin-reverse {
    from { transform: translate(-50%, -50%) rotateZ(0deg); }
    to { transform: translate(-50%, -50%) rotateZ(-360deg); }
}
    </style>
</head>
<body>

    <div class="interface-controls">
        <div class="controls-line">
            <button id="set33-btn" class="control-btn">SET 33 RPM</button>
            <button id="setstop-btn" class="control-btn active">SET STOP</button>
            <button id="set45-btn" class="control-btn">SET 45 RPM</button>
        </div>

        <div class="controls-line">
            <button id="direction-btn" class="control-btn">Direction (Reverse)</button>
            <div class="pitch-group">
                <label for="pitch-slider">Pitch (Vitesse):</label>
                <input type="range" id="pitch-slider" class="pitch-slider" min="0.5" max="1.5" step="0.01" value="1.0" aria-label="Contrôle du pitch de la vitesse de lecture">
            </div>
        </div>
    </div>

    <div class="scene">
        <div class="turntable-base">
            <div class="speed-selector-container">
                <div class="selector-label">33 — STOP — 45</div>
                <div class="selector-base">
                    <div id="speed-knob" class="selector-knob"></div>
                </div>
            </div>

            <div id="tonearm-container" class="tonearm-container">
                <div class="tonearm-image">
                </div>
            </div>
        </div>
        <div class="record-container">
            <div class="platter"></div>
            <div class="vinyl-record"></div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Constantes du DOM
            const vinyl = document.querySelector('.vinyl-record');
            const knob = document.getElementById('speed-knob');
            const set33Btn = document.getElementById('set33-btn');
            const setStopBtn = document.getElementById('setstop-btn');
            const set45Btn = document.getElementById('set45-btn');
            const directionBtn = document.getElementById('direction-btn');
            const pitchSlider = document.getElementById('pitch-slider');
            const tonearmContainer = document.getElementById('tonearm-container'); 

            // Constantes de Vitesse (Réelles)
            const RPM_33 = 33.33;
            const RPM_45 = 45;
            
            // Récupère la durée de base définie dans le CSS
            const BASE_DURATION = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--speed-33-duration').replace('s', ''));

            // État de la platine
            let isRunning = false;
            let currentSpeedDuration = BASE_DURATION; 
            let isReversed = false;


            /**
             * Calcule la durée d'animation requise en fonction du RPM cible.
             */
            function getAnimationDuration(rpm) {
                if (rpm === 0) return 1000;
                const duration = BASE_DURATION * (RPM_33 / rpm);
                return duration.toFixed(2);
            }

            /**
             * Met à jour l'animation du disque.
             */
            function updateAnimation() {
                const pitchFactor = parseFloat(pitchSlider.value);
                let finalDuration;

                if (isRunning) {
                    finalDuration = (currentSpeedDuration / pitchFactor).toFixed(2);
                } else {
                    finalDuration = 1000; 
                }

                vinyl.style.animationName = isReversed ? 'spin-reverse' : 'spin';
                vinyl.style.animationDuration = `${finalDuration}s`;
                vinyl.style.animationPlayState = isRunning ? 'running' : 'paused';
            }

            /**
             * Définit la vitesse et met à jour les indicateurs visuels et le bras.
             */
            function setSpeedAndKnob(rpm, button) {
                [set33Btn, setStopBtn, set45Btn].forEach(btn => btn.classList.remove('active'));

                let knobRotation = 0;
                // Rotation de repos du bras (pointant vers l'extérieur droit)
                let armRotationZ = -60; 

                if (rpm === RPM_33 || rpm === RPM_45) {
                    currentSpeedDuration = getAnimationDuration(rpm);
                    isRunning = true;
                    knobRotation = (rpm === RPM_33) ? -30 : 30;
                    // Rotation de lecture du bras (pointant vers le disque)
                    // Ajuster cette valeur pour que l'aiguille touche le disque :
                    armRotationZ = -10; 
                } else { // STOP (rpm = 0)
                    currentSpeedDuration = 0;
                    isRunning = false;
                    knobRotation = 0;
                    // armRotationZ reste à -60 (repos)
                }

                knob.style.transform = `translate(-50%, -50%) rotateZ(${knobRotation}deg)`;
                button.classList.add('active');

                // Contrôle du mouvement du bras
                // IMPORTANT : On doit conserver le rotateX(-70deg) pour l'inclinaison 3D, car il a été retiré du CSS de base du conteneur.
                tonearmContainer.style.transform = `rotateX(-70deg) rotateZ(${armRotationZ}deg)`;

                updateAnimation();
            }

            // Événements
            set33Btn.addEventListener('click', () => setSpeedAndKnob(RPM_33, set33Btn));
            setStopBtn.addEventListener('click', () => setSpeedAndKnob(0, setStopBtn));
            set45Btn.addEventListener('click', () => setSpeedAndKnob(RPM_45, set45Btn));

            pitchSlider.addEventListener('input', () => {
                if (isRunning) {
                    updateAnimation();
                }
            });

            directionBtn.addEventListener('click', () => {
                isReversed = !isReversed;
                directionBtn.classList.toggle('active', isReversed);
                directionBtn.textContent = isReversed ? 'Direction (Forward)' : 'Direction (Reverse)';
                updateAnimation();
            });

            // Initialisation à l'arrêt
            setSpeedAndKnob(0, setStopBtn);
        });
    </script>
</body>
</html>
